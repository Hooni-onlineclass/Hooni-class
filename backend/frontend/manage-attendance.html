
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¶œì„ ê´€ë¦¬</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f8ff;
      padding: 40px;
      max-width: 900px;
      margin: auto;
    }
    h1, h2 {
      color: #007bff;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #007bff;
      color: white;
    }
    button {
      padding: 6px 10px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .edit {
      background-color: #ffc107;
      color: black;
    }
    .delete {
      background-color: #dc3545;
      color: white;
    }
    .add {
      background-color: #28a745;
      color: white;
      margin-top: 20px;
    }
    .approve {
      background-color: #28a745;
      color: white;
    }
    input, select {
      padding: 8px;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .empty {
      text-align: center;
      font-size: 16px;
      color: #666;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <h1>ğŸ† ì¶œì„ ê´€ë¦¬</h1>

  <!-- âœ… ìˆ˜ë™ ì¶œì„ ê´€ë¦¬ í…Œì´ë¸” -->
  <table id="attendanceTable">
    <thead>
      <tr>
        <th>ì´ë¦„</th>
        <th>ë‚ ì§œ</th>
        <th>ì¶œì„ ìƒíƒœ</th>
        <th>ê´€ë¦¬</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- âœ… ìˆ˜ë™ ì¶”ê°€ ì…ë ¥ -->
  <div>
    <input type="text" id="nameInput" placeholder="ì´ë¦„" />
    <input type="date" id="dateInput" />
    <select id="statusInput">
      <option value="ì¶œì„">ì¶œì„</option>
      <option value="ì§€ê°">ì§€ê°</option>
      <option value="ê²°ì„">ê²°ì„</option>
    </select>
    <button class="add" onclick="addRow()">ì¶”ê°€</button>
  </div>

  <!-- âœ… ìë™ ì¶œì„ ìš”ì²­ ëª©ë¡ -->
  <h2>ğŸ“¥ ì¶œì„ ìš”ì²­ ëª©ë¡</h2>
  <div id="emptyMessage" class="empty"></div>
  <table id="requestTable">
    <thead>
      <tr>
        <th>ì´ë¦„</th>
        <th>ë‚ ì§œ</th>
        <th>ì²˜ë¦¬</th>
      </tr>
    </thead>
    <tbody id="requestBody"></tbody>
  </table>

  <script>
    async function loadAttendanceTable() {
      try {
        const res = await fetch("/api/attendance");
        const attendance = await res.json();
        const tbody = document.querySelector("#attendanceTable tbody");
        tbody.innerHTML = "";

        for (const date in attendance) {
          attendance[date].forEach(name => {
            const row = tbody.insertRow();
            row.innerHTML = `
              <td>${name}</td>
              <td>${date}</td>
              <td>ì¶œì„</td>
              <td>
                <button class="edit" onclick="editRow(this)">ìˆ˜ì •</button>
                <button class="delete" onclick="deleteRow(this)">ì‚­ì œ</button>
              </td>
            `;
          });
        }
      } catch (err) {
        console.error("ì¶œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜:", err);
      }
    }

    async function addRow() {
      const name = document.getElementById("nameInput").value.trim();
      const date = document.getElementById("dateInput").value;
      const status = document.getElementById("statusInput").value;

      if (!name || !date) {
        alert("ì´ë¦„ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      try {
        const res = await fetch("/api/attendance", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name })
        });
        const result = await res.json();
        alert(result.message);
        loadAttendanceTable();
      } catch (err) {
        alert("ì¶œì„ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }

      document.getElementById("nameInput").value = "";
      document.getElementById("dateInput").value = "";
    }

    async function deleteRow(btn) {
      const row = btn.closest("tr");
      const name = row.cells[0].textContent;
      const date = row.cells[1].textContent;

      if (confirm(`"${name}"ì˜ ì¶œì„ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        try {
          await fetch("/api/attendance", {
            method: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, date })
          });
          row.remove();
        } catch (err) {
          alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }
    }

    async function approveAttendance(name, date) {
      try {
        const res = await fetch("/api/attendance", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name })
        });
        const result = await res.json();
        alert(result.message);
        loadRequests();
        loadAttendanceTable();
      } catch (err) {
        alert("ì¶œì„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }

    function loadRequests() {
      const requests = JSON.parse(localStorage.getItem("attendanceRequests") || "{}");
      const today = new Date().toISOString().split("T")[0];
      const todayRequests = requests[today] || [];

      const tbody = document.getElementById("requestBody");
      const emptyMessage = document.getElementById("emptyMessage");
      tbody.innerHTML = "";
      emptyMessage.textContent = "";

      if (todayRequests.length === 0) {
        emptyMessage.textContent = "ì˜¤ëŠ˜ ì¶œì„ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      todayRequests.forEach(name => {
        const row = document.createElement("tr");

        const nameCell = document.createElement("td");
        nameCell.textContent = name;

        const dateCell = document.createElement("td");
        dateCell.textContent = today;

        const actionCell = document.createElement("td");
        const btn = document.createElement("button");
        btn.textContent = "ì¶œì„ ì²˜ë¦¬";
        btn.className = "approve";
        btn.onclick = function () {
          approveAttendance(name, today);
        };
        actionCell.appendChild(btn);

        row.appendChild(nameCell);
        row.appendChild(dateCell);
        row.appendChild(actionCell);

        tbody.appendChild(row);
      });
    }

    function editRow(btn) {
      const row = btn.closest("tr");
      const name = prompt("ì´ë¦„ ìˆ˜ì •:", row.cells[0].textContent);
      const date = prompt("ë‚ ì§œ ìˆ˜ì •:", row.cells[1].textContent);
      const status = prompt("ì¶œì„ ìƒíƒœ ìˆ˜ì • (ì¶œì„/ì§€ê°/ê²°ì„):", row.cells[2].textContent);

      if (name && date && status) {
        row.cells[0].textContent = name;
        row.cells[1].textContent = date;
        row.cells[2].textContent = status;
      }
    }

    window.onload = function () {
      loadRequests();
      loadAttendanceTable();
    };
  </script>

</body>
</html>
