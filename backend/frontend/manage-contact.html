
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¬¸ì˜ ê´€ë¦¬</title>
  <style>
    body { font-family: 'Segoe UI'; padding: 40px; background: #eef3ff; }
    h1 { margin-bottom: 30px; text-align: center; color: #007bff; }
    .inquiry-list {
      max-width: 800px; margin: 0 auto;
    }
    .inquiry {
      background: white; padding: 20px;
      border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 20px; position: relative;
    }
    .inquiry h3 { margin: 0 0 10px; font-size: 16px; color: #333; }
    .inquiry p { margin: 0; color: #555; }
    .inquiry small { display: block; margin-top: 8px; color: #999; }
    .inquiry .reply {
      margin-top: 15px; padding: 10px;
      background: #f1f1f1; border-radius: 8px;
      color: #444; font-size: 14px;
    }
    .inquiry .actions {
      position: absolute; top: 20px; right: 20px;
    }
    .inquiry .actions button {
      background: none; border: none; color: #888;
      font-size: 14px; cursor: pointer; margin-left: 10px;
    }
    .inquiry .actions button:hover { color: #333; }
    .empty {
      text-align: center; font-size: 16px; color: #666;
      margin-top: 40px;
    }
  </style>
</head>
<body>

  <h1>ğŸ“‹ ë¬¸ì˜ ë‚´ì—­ ê´€ë¦¬</h1>
  <div class="inquiry-list" id="inquiryList"></div>

  <script>
  const list = document.getElementById("inquiryList");

  async function loadInquiries() {
    list.innerHTML = "";

    try {
      const res = await fetch("https://hooni-class.onrender.com/api/inquiry");
      const inquiries = await res.json();

      if (inquiries.length === 0) {
        list.innerHTML = `<p class="empty">ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
        return;
      }

      inquiries.forEach((data) => {
        const inquiry = document.createElement("div");
        inquiry.className = "inquiry";
        inquiry.innerHTML = `
          <div class="actions">
            <button onclick="replyInquiry('${data._id}', '${data.reply || ''}')">ğŸ’¬ ë‹µë³€</button>
            <button onclick="editInquiry('${data._id}', '${data.text.replace(/'/g, "\\'")}')">âœï¸ ìˆ˜ì •</button>
            <button onclick="deleteInquiry('${data._id}')">ğŸ—‘ï¸ ì‚­ì œ</button>
          </div>
          <h3>${data.author}</h3>
          <p>${data.text}</p>
          <small>${new Date(data.date).toLocaleString()}</small>
          ${data.reply ? `<div class="reply">ë‹µë³€: ${data.reply}</div>` : ""}
        `;
        list.appendChild(inquiry);
      });
    } catch (err) {
      list.innerHTML = `<p class="empty">ë¬¸ì˜ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
    }
  }

  async function replyInquiry(id, oldReply) {
    const reply = prompt("ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”:", oldReply);
    if (!reply || reply.trim() === "") return;

    try {
      await fetch(`https://hooni-class.onrender.com/api/inquiry/${id}/reply`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ reply: reply.trim() })
      });
      loadInquiries();
    } catch (err) {
      alert("ë‹µë³€ ë“±ë¡ ì‹¤íŒ¨");
    }
  }

  async function deleteInquiry(id) {
    if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    try {
      await fetch(`https://hooni-class.onrender.com/api/inquiry/${id}`, { method: "DELETE" });
      loadInquiries();
    } catch (err) {
      alert("ì‚­ì œ ì‹¤íŒ¨");
    }
  }

  async function editInquiry(id, oldText) {
    const newText = prompt("ë¬¸ì˜ ë‚´ìš©ì„ ìˆ˜ì •í•˜ì„¸ìš”:", oldText);
    if (!newText || newText.trim() === "") return;
    try {
      await fetch(`https://hooni-class.onrender.com/api/inquiry/${id}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: newText.trim() })
      });
      loadInquiries();
    } catch (err) {
      alert("ìˆ˜ì • ì‹¤íŒ¨");
    }
  }

  window.onload = loadInquiries;
</script>


</body>
</html>
